<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'comments/style.css' %}">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h2>
    {% include 'comments/includes/form.html' %}

    <h2 class="mt-4">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
    {% for comment in comments %}
        <div class="comment">
            <strong>{{ comment.user_name }}</strong> ({{ comment.email }})<br>
            {{ comment.text|safe }}<br>
            <small>{{ comment.created_at }}</small>

            {% if comment.files.exists %}
                <div class="attachments">
                    {% for file in comment.files.all %}
                        {% if file.is_image %}
                            <img src="{{ file.file.url }}" width="100">
                        {% elif file.is_text %}
                            <a href="{{ file.file.url }}" target="_blank">üìÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª</a>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endif %}

            {% if comment.replies.exists %}
                <div class="replies" style="margin-left: 30px;">
                    {% for reply in comment.replies.all %}
                        <div class="reply">
                            <strong>{{ reply.user_name }}</strong>: {{ reply.text|safe }}
                            <small>{{ reply.created_at }}</small>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>
    {% endfor %}

    <div class="pagination">
        {% if is_paginated %}
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a>
            {% endif %}
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">–í–ø–µ—Ä—ë–¥</a>
            {% endif %}
        {% endif %}
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>


<script>
    function wrapTag(tag) {
        const textarea = document.querySelector('textarea[name="text"]');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        const tagOpen = `<${tag}>`;
        const tagClose = `</${tag}>`;
        const newText = tagOpen + selectedText + tagClose;

        textarea.setRangeText(newText, start, end, 'end');
        textarea.focus();
    }

    function insertLink() {
        const url = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É:");
        if (!url) return;
        const title = prompt("–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):") || "";
        const textarea = document.querySelector('textarea[name="text"]');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end) || "—Å—Å—ã–ª–∫–∞";
        const tag = `<a href="${url}" title="${title}">${selectedText}</a>`;

        textarea.setRangeText(tag, start, end, 'end');
        textarea.focus();
    }
</script>
</html>